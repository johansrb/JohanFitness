<!doctype html>
<html lang="en" data-mode="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Johan • Fitness & Workout Tracker (PWA)</title>

  <!-- PWA manifest + theme -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b0b0b">

  <!-- iOS standalone settings -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Johan Fit">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">

  <!-- Favicon / icons for browsers -->
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32.png">
  <link rel="shortcut icon" href="icons/favicon-32.png" type="image/png">

  <style>
    :root{
      --brand:#7d0a0a; --brand-2:#b21a1a;
      --ink:#111; --muted:#666; --line:#ececec;
      --bg:#fff; --card:#fff;
      --bg-dark:#0b0b0b; --ink-dark:#f2f2f2; --card-dark:#121212; --line-dark:#242424;scr
      --ok:#0a7d36; --bad:#a11;
    }

    /* Light/Dark */
    html[data-mode="dark"] body{background:var(--bg-dark);color:var(--ink-dark)}
    html[data-mode="dark"] header{background:#0b0b0b;border-bottom-color:#222}
    html[data-mode="dark"] .card{background:var(--card-dark);border-color:var(--line-dark)}
    html[data-mode="dark"] .tabs button{background:#0e0e0e;border-color:#222;color:#f1f1f1}
    html[data-mode="dark"] .tabs button.active{background:var(--brand);border-color:var(--brand)}
    html[data-mode="dark"] table tr{border-bottom-color:#1f1f1f}
    html[data-mode="dark"] .pill{border-color:#333}

    *{box-sizing:border-box}
    body{margin:0;font-family:Calibri,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}

    header{
      padding:14px 16px;
      border-bottom:2px solid var(--line);
      background:linear-gradient(180deg,#fff,#f8f8f8);
      position:sticky;top:0;z-index:50;
      display:flex;gap:12px;align-items:center;justify-content:space-between;
    }
    .brand{display:flex;gap:10px;align-items:center}
    .logo{
      width:28px;height:28px;border-radius:8px;
      background:radial-gradient(circle at 35% 30%, #ff6565, #7d0a0a 60%);
      box-shadow:inset 0 2px 6px rgba(255,255,255,.25), 0 2px 6px rgba(0,0,0,.2);
    }
    .brand h1{font-size:18px;margin:0;color:var(--brand)}
    .header-actions{display:flex;gap:8px;align-items:center}
    .toggle{border:1px solid var(--line);border-radius:10px;padding:6px 10px;background:#fff;cursor:pointer}

    main{max-width:1100px;margin:0 auto;padding:12px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    .tabs button{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 12px;cursor:pointer}
    .tabs button.active{background:var(--brand);color:#fff;border-color:var(--brand)}

    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:940px){.grid{grid-template-columns:1.1fr .9fr}}

    .card{border:1px solid var(--line);border-radius:12px;background:var(--card);padding:14px;margin-bottom:14px}
    .card h2{margin:0 0 8px;color:var(--brand);font-size:18px}

    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:8px;margin:8px 0}
    .row>div{grid-column:span 12}
    @media(min-width:680px){
      .col-2{grid-column:span 2}.col-3{grid-column:span 3}.col-4{grid-column:span 4}.col-6{grid-column:span 6}
    }

    input,select,button{
      width:100%;padding:10px;border:1px solid #dad7d7;border-radius:10px;font-size:15px;background:#fff;color:inherit
    }
    button.primary{background:var(--brand);color:#fff;border:none}
    button.link{background:#fff;border:1px dashed var(--line);color:var(--brand)}

    .banner{border:1px dashed var(--brand);padding:10px;border-radius:10px;background:#fff6f6;margin-bottom:12px}
    .pill{display:inline-block;padding:6px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:#555}

    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    tfoot td{font-weight:700}

    /* Autocomplete dropdown */
    .ac-wrap{position:relative}
    .ac-list{
      position:absolute;top:100%;left:0;right:0;z-index:40;
      background:var(--card);border:1px solid var(--line);border-radius:10px;max-height:220px;overflow:auto;
      box-shadow:0 8px 20px rgba(0,0,0,.08);
      display:none;
    }
    .ac-item{padding:10px;cursor:pointer}
    .ac-item:hover{background:#fafafa}
    html[data-mode="dark"] .ac-item:hover{background:#141414}

    /* Tiny spinner for internal loads */
    .spinner{
      width:18px;height:18px;border:2px solid rgba(125,10,10,.25);border-top-color:#7d0a0a;border-radius:50%;
      animation:spin 1s linear infinite;display:inline-block;vertical-align:middle
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .banner .spinner{margin-left:8px}

    /* Helper text */
    .foot{font-size:12px;color:#777}
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo"></div>
    <h1>Fitness Tracker</h1>
  </div>
  <div class="header-actions">
    <button id="toggleTheme" class="toggle">🌙</button>
  </div>
</header>

<main>
  <!-- Next Training Banner -->
  <div id="nextTraining" class="banner">Next Training Day: Chest & Triceps <span class="spinner" style="display:none"></span></div>

  <!-- Tabs -->
  <nav class="tabs">
    <button class="active" data-tab="log">Daily Log</button>
    <button data-tab="weekly">Weekly Roll-Up</button>
    <button data-tab="progress">Progress</button>
    <button data-tab="plan">Workout Plan</button>
    <button data-tab="help">Help</button>
  </nav>

  <!-- Daily Log -->
  <section id="log" class="tab">
    <div class="grid">
      <div class="card">
        <h2>Meal Entry</h2>
        <div class="row">
          <div class="col-6 ac-wrap">
            <input id="foodInput" placeholder="Search food...">
            <div id="acList" class="ac-list"></div>
          </div>
          <div class="col-3">
            <input id="qtyInput" type="number" placeholder="Qty" min="1" value="1">
          </div>
          <div class="col-3">
            <select id="unitInput">
              <option value="g">g</option>
              <option value="oz">oz</option>
              <option value="cup">cup</option>
              <option value="tbsp">tbsp</option>
            </select>
          </div>
        </div>
        <button id="addMeal" class="primary">Add Meal</button>
        <table id="mealTable">
          <thead><tr><th>Food</th><th>Qty</th><th>Cals</th><th>Protein</th><th>Carbs</th><th>Fat</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><td colspan="2">Totals</td><td id="calTotal">0</td><td id="proTotal">0</td><td id="carbTotal">0</td><td id="fatTotal">0</td></tr></tfoot>
        </table>
      </div>

      <div class="card">
        <h2>Workout Entry</h2>
        <input id="workoutInput" placeholder="e.g. Bench Press 3x10">
        <button id="addWorkout" class="primary">Add Workout</button>
        <div id="workoutList"></div>
      </div>
    </div>
  </section>

  <!-- Weekly Roll-Up -->
  <section id="weekly" class="tab" style="display:none">
    <div class="card">
      <h2>Weekly Roll-Up</h2>
      <div id="weeklyContent">No data yet.</div>
    </div>
  </section>

  <!-- Progress -->
  <section id="progress" class="tab" style="display:none">
    <div class="card">
      <h2>Progress & Milestones</h2>
      <div id="progressContent">Track weight, PRs, and milestones here.</div>
    </div>
  </section>

  <!-- Workout Plan -->
  <section id="plan" class="tab" style="display:none">
    <div class="card">
      <h2>Workout Plan</h2>
      <ul>
        <li><b>Day 1 – Chest & Triceps</b><br>Bench Press – 4×8 <a href="https://www.youtube.com/results?search_query=bench+press+form" target="_blank">Video</a></li>
        <li><b>Day 2 – Back & Biceps</b><br>Lat Pulldown – 4×10 <a href="https://www.youtube.com/results?search_query=lat+pulldown+form" target="_blank">Video</a></li>
        <li><b>Day 3 – Legs</b><br>Squat – 4×8 <a href="https://www.youtube.com/results?search_query=squat+form" target="_blank">Video</a></li>
        <li><b>Day 4 – Shoulders & Core</b><br>Overhead Press – 4×8 <a href="https://www.youtube.com/results?search_query=overhead+press+form" target="_blank">Video</a></li>
      </ul>
    </div>
  </section>

  <!-- Help -->
  <section id="help" class="tab" style="display:none">
    <div class="card">
      <h2>Help</h2>
      <p>Use this app to log meals, track workouts, and follow your plan. 
         Tap 🌙 to toggle Dark Mode. 
         Add to Home Screen for app-like experience.</p>
    </div>
  </section>
</main>
<script>
/* ===========================
   Helpers
=========================== */
const U = {
  normalizeAmount(qty, unit, baseUnit){
    qty = Number(qty||0);
    unit = (unit||'g').toLowerCase();
    baseUnit = (baseUnit||'100g').toLowerCase();

    if (baseUnit.startsWith('1 ')) return { multiplier: qty, note: baseUnit };

    if (baseUnit === '100g') {
      if (unit === 'g') return { multiplier: qty/100, note: 'per 100g' };
      if (unit === 'oz') return { multiplier: (qty*28.3495)/100, note: 'per 100g' };
      if (unit === 'cup') return { multiplier: (qty*240)/100, note: 'per 100g (cup≈240g*)' };
      if (unit === 'tbsp') return { multiplier: (qty*15)/100, note: 'per 100g (tbsp≈15g*)' };
    }
    if (baseUnit === '1 tbsp') {
      if (unit === 'tbsp') return { multiplier: qty, note: 'per tbsp' };
      if (unit === 'g') return { multiplier: qty/15, note: 'tbsp≈15g*' };
      if (unit === 'oz') return { multiplier: (qty*28.3495)/15, note: 'tbsp≈15g*' };
      if (unit === 'cup') return { multiplier: (qty*16), note: '1 cup = 16 tbsp' };
    }
    if (baseUnit === '1 cup') {
      if (unit === 'cup') return { multiplier: qty, note: 'per cup' };
      if (unit === 'tbsp') return { multiplier: qty/16, note: '16 tbsp = 1 cup' };
      if (unit === 'g') return { multiplier: qty/240, note: 'cup≈240g*' };
      if (unit === 'oz') return { multiplier: (qty*28.3495)/240, note: 'cup≈240g*' };
    }
    return { multiplier: qty, note: baseUnit };
  },

  lineToEntry(line){
    const p = line.split('|').map(s=>s.trim());
    return { name:p[0], base:p[1], cal:+p[2], pro:+p[3], carb:+p[4], fat:+p[5] };
  }
};

/* ===========================
   Tabs
=========================== */
document.querySelectorAll("nav.tabs button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll("nav.tabs button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll("main .tab").forEach(t=>t.style.display="none");
    document.getElementById(btn.dataset.tab).style.display="block";
  });
});

/* ===========================
   Theme toggle
=========================== */
const toggleBtn=document.getElementById("toggleTheme");
toggleBtn.addEventListener("click",()=>{
  const mode=document.documentElement.getAttribute("data-mode")==="dark"?"light":"dark";
  document.documentElement.setAttribute("data-mode",mode);
  localStorage.setItem("theme",mode);
  toggleBtn.textContent=mode==="dark"?"☀️":"🌙";
});
if(localStorage.getItem("theme")==="dark"){document.documentElement.setAttribute("data-mode","dark");toggleBtn.textContent="☀️";}

/* ===========================
   Next Training Day rotation
=========================== */
const banner = document.getElementById("nextTraining");
const spinner = banner.querySelector(".spinner");
const split = ["Chest & Triceps","Back & Biceps","Legs","Shoulders & Core","Rest"];
function updateTrainingBanner(){
  let idx = parseInt(localStorage.getItem("trainDay")||"0",10);
  banner.firstChild.textContent = "Next Training Day: " + split[idx];
  idx = (idx+1) % split.length;
  localStorage.setItem("trainDay", String(idx));
}
spinner.style.display="inline-block";
setTimeout(()=>{ updateTrainingBanner(); spinner.style.display="none"; }, 400);

/* ===========================
   Service Worker (with cache bump)
=========================== */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js?v=2'); // bump v=2 → forces update
}
</script>

</body>

</html>



